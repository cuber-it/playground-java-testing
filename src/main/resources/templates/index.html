<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Todo App</title>
    <style>
        body { font-family: sans-serif; max-width: 700px; margin: 40px auto; padding: 0 20px; }
        h1 { color: #333; }
        .todo { padding: 12px; margin: 8px 0; background: #f5f5f5; border-radius: 4px; }
        .todo.done { background: #e8f5e9; }
        .todo.overdue { background: #ffebee; }
        .todo-header { display: flex; justify-content: space-between; align-items: center; }
        .todo-title { font-weight: bold; }
        .todo-title.done { text-decoration: line-through; color: #888; }
        .todo-details { font-size: 0.9em; color: #666; margin-top: 5px; }
        .todo-actions { display: flex; gap: 5px; }
        form.inline { display: inline; }
        input[type="text"], input[type="date"] { padding: 8px; margin: 2px; }
        button, a.btn { padding: 8px 12px; cursor: pointer; border: none; border-radius: 3px; text-decoration: none; font-size: 14px; }
        .btn-add { background: #2196f3; color: white; }
        .btn-done { background: #4caf50; color: white; }
        .btn-edit { background: #ff9800; color: white; }
        .btn-delete { background: #f44336; color: white; }
        .btn-export { background: #9c27b0; color: white; }
        .btn-search { background: #607d8b; color: white; }
        .add-form { margin: 20px 0; padding: 15px; background: #fafafa; border-radius: 4px; }
        .search-form { margin: 20px 0; display: flex; gap: 5px; }
        .stats { margin: 20px 0; padding: 10px; background: #e3f2fd; border-radius: 4px; display: flex; justify-content: space-between; align-items: center; }
    </style>
</head>
<body>
    <h1>Meine Todos</h1>

    <div class="stats">
        <div>
            <span th:text="'Gesamt: ' + ${todos.size()}">0</span> |
            <span th:text="'Offen: ' + ${todos.?[!done].size()}">0</span> |
            <span th:text="'Erledigt: ' + ${todos.?[done].size()}">0</span>
        </div>
        <a href="/export" class="btn btn-export">CSV Export</a>
    </div>

    <div class="search-form">
        <form th:action="@{/}" method="get" style="display: flex; gap: 5px; flex: 1;">
            <input type="text" name="q" th:value="${searchQuery}" placeholder="Suchen..." style="flex: 1;" />
            <button type="submit" class="btn-search">Suchen</button>
        </form>
        <a th:if="${searchQuery}" href="/" class="btn" style="background: #ccc;">Alle</a>
    </div>

    <div class="add-form">
        <form th:action="@{/add}" th:object="${newTodo}" method="post">
            <input type="text" th:field="*{title}" placeholder="Titel" required style="width: 200px;" />
            <input type="text" th:field="*{description}" placeholder="Beschreibung" style="width: 180px;" />
            <input type="date" th:field="*{dueDate}" />
            <button type="submit" class="btn-add">Hinzufuegen</button>
        </form>
    </div>

    <div th:each="todo : ${todos}" th:classappend="${todo.done} ? 'todo done' : (${todo.overdue} ? 'todo overdue' : 'todo')">
        <div class="todo-header">
            <span class="todo-title" th:classappend="${todo.done} ? 'done' : ''" th:text="${todo.title}">Titel</span>
            <div class="todo-actions">
                <a th:href="@{/{id}/edit(id=${todo.id})}" class="btn btn-edit">Bearbeiten</a>
                <form th:unless="${todo.done}" th:action="@{/{id}/done(id=${todo.id})}" method="post" class="inline">
                    <button type="submit" class="btn-done">Erledigt</button>
                </form>
                <form th:action="@{/{id}/delete(id=${todo.id})}" method="post" class="inline">
                    <button type="submit" class="btn-delete">X</button>
                </form>
            </div>
        </div>
        <div class="todo-details" th:if="${todo.description != null || todo.dueDate != null}">
            <span th:if="${todo.description}" th:text="${todo.description}"></span>
            <span th:if="${todo.dueDate}"> | Faellig: <span th:text="${todo.dueDate}"></span></span>
            <span th:if="${todo.overdue}" style="color: red;"> (ueberfaellig!)</span>
        </div>
    </div>

    <div th:if="${todos.empty}" style="color: #888; padding: 20px;">
        Keine Todos vorhanden.
    </div>
</body>
</html>
